
<div class="main-banner">
  <h1 class="text-white text-center mt-5">Poutine Podium</h1>
  <p class="text-white text-center">Le site où l'on critique sa poutine.</p>
  <div class="d-flex align-items-center justify-content-center flex-column flex-sm-row my-4">
  <%= link_to 'Critiquer une poutine', root_path, class: "btn btn-main-action" %>
  <%= link_to 'Naviguer les restaurants', root_path, class: "btn btn-secondary-action" %>
  </div>
</div>



<h2 class="text-center my-3">Palmarès</h2>




<table class="table-podium table">
  <% @restaurants.each_with_index do |restaurant, i| %>
    <tr data-toggle="collapse" data-target="#collapse-<%= i %>" class="table-podium-header">
      <td class="d-none d-sm-block">
        <% if restaurant.photo.attached? %>
          <%= cl_image_tag restaurant.photo.key, class: "img-circle" %>
        <% else %>
          <%= image_tag 'https://previews.123rf.com/images/sudowoodo/sudowoodo1701/sudowoodo170100010/68834656-poutine-traditional-canadian-food-from-quebec-potato-french-fries-with-gravy-and-cheese-curds-isolat.jpg', class: "img-circle" %>
        <% end %>
      </td>
    <td>#<%= i + 1 %></td>
      <td class="w-100"><%= restaurant.name %></td>
      <td>
        Montréal
      </td>
      <td>94%</td>
    </tr>
    <tr class="table-podium-body">
      <td colspan="12">
        <div class="collapse" id="collapse-<%= i %>">
          <div class="p-2">
            <p>
              <%= restaurant.description %>
            </p>

            <div class="container-fluid">
              <div id="carousel-example-<%= i %>" class="carousel carousel-<%= i %> slide" data-interval="false" data-ride="carousel-example-<%= i %>">

                <div class="carousel-inner c-<%= i %> row w-100 mx-auto" role="listbox">
                  <% restaurant.reviews.map{ |r| r.photos }.flatten.each_with_index do |photo, j| %>
                    <div class="carousel-item ci-<%= i %> col-12 col-sm-6 col-md-4 <%= 'active' if j == 0 %>">
                      <%= cl_image_tag photo.key, height: 160, width: 240, crop: :fill, class: "img-fluid mx-auto d-block carousel-img" %>
                    </div>
                  <% end %>
                </div>

                <a class="carousel-control-prev" href="#carousel-example-<%= i %>" role="button" data-slide="prev">
                  <span class="carousel-control-prev-icon" aria-hidden="true"></span>
                  <span class="sr-only">Previous</span>
                </a>
                <a class="carousel-control-next" href="#carousel-example-<%= i %>" role="button" data-slide="next">
                  <span class="carousel-control-next-icon" aria-hidden="true"></span>
                  <span class="sr-only">Next</span>
                </a>
              </div>
              <%= link_to 'Voir le restaurant', restaurant_path(restaurant), class: "btn btn-main-action my-4" %>
            </div>
          </div>
        </div>
      </td>
    </tr>
  <% end %>
</table>

<h2 class="text-center my-3">Derniers avis</h2>

<div class="card-review-container">


</div>




<script>

  var numberOfCarousels = $('.carousel').length
  console.log(numberOfCarousels)
  console.log('page is here')
  console.log('hi')

  for (let i = 0; i < numberOfCarousels; i++) {
    $(`#carousel-example-${i}`).on(`slide.bs.carousel`, function (e) {
      var $e = $(e.relatedTarget);
      var idx = $e.index();
      var itemsPerSlide = 4;
      var totalItems = this.querySelectorAll('.carousel-item').length;

      console.log(idx, itemsPerSlide, totalItems)
      if (idx >= totalItems - (itemsPerSlide - 1)) {
        var it = itemsPerSlide - (totalItems - idx);
        for (var j=0; j< it ; j++) {
          // append slides to end
          if (e.direction == "left") {
            $(`.ci-${i}`).eq(j).appendTo(`.c-${i}`);
          }
          else {
            $(`.ci-${i}`).eq(0).appendTo(`.c-${i}`);
          }
        }
      }
    });
  }


</script>


<!-- Top content -->






